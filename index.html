<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ランプシャッター</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- モード選択画面 -->
  <div id="modeSelect">
    <h1 class="title">ランプシャッター</h1>
    <p class="subtitle">モードを選択してください</p>
    <div class="mode-grid">
      <button class="mode-card mode-day" data-mode="day">
        <img src="images/mode_day.png" alt="昼モード" class="mode-illust">
        <div class="mode-label">昼モード</div>
      </button>
      <button class="mode-card mode-night" data-mode="night">
        <img src="images/mode_night.png" alt="夜モード" class="mode-illust">
        <div class="mode-label">夜モード</div>
      </button>
      <button class="mode-card mode-inspect" data-mode="inspect">
        <img src="images/mode_inspect.png" alt="調査モード" class="mode-illust">
        <div class="mode-label">調査モード</div>
      </button>
    </div>
    <p class="hint">
      ※ iPhone Safari 推奨・PWA インストール推奨
    </p>
  </div>

  <!-- メインアプリ画面 -->
  <div id="app" class="hidden">
    <!-- 上部：現在モード名 -->
    <header id="modeHeader">
      <span id="modeName">モード</span>
      <button id="backToModeSelect" aria-label="モード選択に戻る">← モード変更</button>
    </header>

    <!-- カメラ＆ROI -->
    <main id="mainArea">
      <div id="videoWrapper">
        <video id="video" playsinline autoplay muted></video>
        <canvas id="previewCanvas"></canvas>
        <!-- フラッシュ用オーバーレイ -->
        <div id="flashOverlay"></div>
      </div>

      <!-- 調査モードの数値パネル（昼/夜では小さく表示） -->
      <section id="inspectPanel">
        <div class="inspect-row"><span>Ravg</span><span id="rAvgVal">-</span></div>
        <div class="inspect-row"><span>Gavg</span><span id="gAvgVal">-</span></div>
        <div class="inspect-row"><span>Bavg</span><span id="bAvgVal">-</span></div>
        <div class="inspect-row"><span>red%</span><span id="redPctVal">-</span></div>
        <div class="inspect-row"><span>green%</span><span id="greenPctVal">-</span></div>
        <div class="inspect-row"><span>blue%</span><span id="bluePctVal">-</span></div>
      </section>
    </main>

    <!-- 撮影ボタン（カメライラスト・小さめ） -->
    <div id="shutterContainer">
      <button id="shutterButton" aria-label="撮影">
        <img src="images/camera.png" alt="撮影" id="shutterImage">
      </button>
    </div>

    <!-- OK 音声（女性声） -->
    <audio id="okSound" src="audio/ok_voice_female.mp3" preload="auto"></audio>

    <!-- 撮影用オフスクリーン canvas（非表示） -->
    <canvas id="captureCanvas" class="hidden"></canvas>
  </div>

  <script src="app.js" defer></script>
</body>
</html>
